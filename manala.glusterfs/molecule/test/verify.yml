---

- name: Verify
  hosts: all
  tasks:
    - name: Volume foo must be absent
      command: gluster volume info foo
      changed_when: false
      register: __command
      failed_when: "'Volume foo does not exist' not in __command.stderr"

    - name: Register volume_test info
      command: gluster volume info
      changed_when: false
      register: __command

    - name: Verify volume_test info
      assert:
        that:
            - "'Volume Name: volume_test' in __command.stdout"
            - "'Status: Started' in __command.stdout"
            - "'Bricks:' in __command.stdout"
            - "'Brick1: {{ ansible_fqdn }}:/home/vol' in __command.stdout"
            - "'Brick2: {{ ansible_fqdn }}:/home/vol2' in __command.stdout"
            - "'Brick3: {{ ansible_fqdn }}:/home/vol3' in __command.stdout"
        quiet: true
