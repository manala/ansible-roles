---

- name: install > Stat bin
  stat:
    path: "{{ manala_symfony_cli_bin }}"
  register: __manala_symfony_cli_bin_stat_result

- name: install > Get latest version
  uri:
    url: https://github.com/symfony-cli/symfony-cli/releases/latest
    return_content: true
  register: __manala_symfony_cli_version_latest
  when:
    - not __manala_symfony_cli_bin_stat_result.stat.exists
    - manala_symfony_cli_version is none

- name: install > Install
  unarchive:
    src: "{{
        'https://github.com/symfony-cli/symfony-cli/releases/download/v%(version)s/symfony-cli_linux_%(architecture)s.tar.gz'|format(
          version=manala_symfony_cli_version,
          architecture=ansible_architecture|manala.roles.symfony_cli_architecture,
        )
    }}"
    dest: "{{ manala_symfony_cli_bin|dirname }}"
    remote_src: true
    extra_opts:
      - --transform
      - s/^symfony_cli/{{ manala_symfony_cli_bin|basename }}/
    owner: root
    group: root
    mode: "0755"
  when: not __manala_symfony_cli_bin_stat_result.stat.exists
