{%- import '_macros.j2' as macros with context -%}

{% set config = manala_elasticsearch_environment -%}

# Run Elasticsearch as this user ID and group ID
{{ macros.config_row(config, 'ES_USER', '#ES_USER=elasticsearch', 0, true) }}
{{ macros.config_row(config, 'ES_GROUP', '#ES_GROUP=elasticsearch', 0, true) }}

# Heap Size (defaults to 256m min, 1g max)
{{ macros.config_row(config, 'ES_HEAP_SIZE', '#ES_HEAP_SIZE=2g', 0, true) }}

# Heap new generation
{{ macros.config_row(config, 'ES_HEAP_NEWSIZE', '#ES_HEAP_NEWSIZE=', 0, true) }}

# max direct memory
{{ macros.config_row(config, 'ES_DIRECT_SIZE', '#ES_DIRECT_SIZE=', 0, true) }}

# Maximum number of open files, defaults to 65535.
{{ macros.config_row(config, 'MAX_OPEN_FILES', '#MAX_OPEN_FILES=65535', 0, true) }}

# Maximum locked memory size. Set to "unlimited" if you use the
# bootstrap.mlockall option in elasticsearch.yml. You must also set
# ES_HEAP_SIZE.
{{ macros.config_row(config, 'MAX_LOCKED_MEMORY', '#MAX_LOCKED_MEMORY=unlimited', 0, true) }}

# Maximum number of VMA (Virtual Memory Areas) a process can own
{{ macros.config_row(config, 'MAX_MAP_COUNT', '#MAX_MAP_COUNT=262144', 0, true) }}

# Elasticsearch log directory
{{ macros.config_row(config, 'LOG_DIR', '#LOG_DIR=/var/log/elasticsearch', 0, true) }}

# Elasticsearch data directory
{{ macros.config_row(config, 'DATA_DIR', '#DATA_DIR=/var/lib/elasticsearch', 0, true) }}

# Elasticsearch work directory
{{ macros.config_row(config, 'WORK_DIR', '#WORK_DIR=/tmp/elasticsearch', 0, true) }}

# Elasticsearch configuration directory
{{ macros.config_row(config, 'CONF_DIR', '#CONF_DIR=/etc/elasticsearch', 0, true) }}

# Elasticsearch configuration file (elasticsearch.yml)
{{ macros.config_row(config, 'CONF_FILE', '#CONF_FILE=/etc/elasticsearch/elasticsearch.yml', 0, true) }}

# Additional Java OPTS
{{ macros.config_row(config, 'ES_JAVA_OPTS', '#ES_JAVA_OPTS=', 0, true) }}

# Configure restart on package upgrade (true, every other setting will lead to not restarting)
{{ macros.config_row(config, 'RESTART_ON_UPGRADE', '#RESTART_ON_UPGRADE=true', 0, true) }}

{{ macros.config(config, [
  'ES_USER',
  'ES_GROUP',
  'ES_HEAP_SIZE',
  'ES_HEAP_NEWSIZE',
  'ES_DIRECT_SIZE',
  'MAX_OPEN_FILES',
  'MAX_LOCKED_MEMORY',
  'MAX_MAP_COUNT',
  'LOG_DIR',
  'DATA_DIR',
  'WORK_DIR',
  'CONF_DIR',
  'CONF_FILE',
  'ES_JAVA_OPTS',
  'RESTART_ON_UPGRADE'
]) -}}
